"use strict";(self.webpackChunkdocs_rancherdesktop_io=self.webpackChunkdocs_rancherdesktop_io||[]).push([[9230],{36556:function(e,n,i){i.r(n),i.d(n,{assets:function(){return c},contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return t},metadata:function(){return a},toc:function(){return d}});var s=i(85893),r=i(11151),o=i(93687);const t={title:"Running When Offline"},l=void 0,a={id:"how-to-guides/running-air-gapped",title:"Running When Offline",description:"Rancher Desktop can be run when offline, aka in air-gapped mode. This document covers requirements",source:"@site/versioned_docs/version-1.11/how-to-guides/running-air-gapped.md",sourceDirName:"how-to-guides",slug:"/how-to-guides/running-air-gapped",permalink:"/1.11/how-to-guides/running-air-gapped",draft:!1,unlisted:!1,editUrl:"https://github.com/rancher-sandbox/docs.rancherdesktop.io/edit/main/versioned_docs/version-1.11/how-to-guides/running-air-gapped.md",tags:[],version:"1.11",frontMatter:{title:"Running When Offline"},sidebar:"tutorialSidebar",previous:{title:"Increasing Open File Limit",permalink:"/1.11/how-to-guides/increasing-open-file-limit"},next:{title:"ODO and Rancher Desktop",permalink:"/1.11/how-to-guides/odo-rancher-desktop"}},c={},d=[{value:"A Note for Windows users",id:"a-note-for-windows-users",level:3},{value:"Network-Sensitive areas",id:"network-sensitive-areas",level:3},{value:"Existing Deployments",id:"existing-deployments",level:3},{value:"Preparing an Air-Gapped System",id:"preparing-an-air-gapped-system",level:3},{value:"The Cache Directory",id:"the-cache-directory",level:4},{value:"The kuberlr Directory",id:"the-kuberlr-directory",level:4},{value:"A Note on Versions",id:"a-note-on-versions",level:5}];function h(e){const n={a:"a",code:"code",em:"em",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components},{Head:i,TabItem:t,Tabs:l}=n;return i||p("Head",!0),t||p("TabItem",!0),l||p("Tabs",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{children:(0,s.jsx)("link",{rel:"canonical",href:"https://docs.rancherdesktop.io/how-to-guides/running-air-gapped"})}),"\n","\n","\n",(0,s.jsx)(n.p,{children:"Rancher Desktop can be run when offline, aka in air-gapped mode. This document covers requirements\nand possible problems when running in air-gapped mode."}),"\n",(0,s.jsx)(n.h3,{id:"a-note-for-windows-users",children:"A Note for Windows users"}),"\n",(0,s.jsxs)(n.p,{children:["This document uses Powershell syntax for environment variables. If you're using the Command shell\ninstead, where you see an environment variable reference of ",(0,s.jsx)(n.code,{children:"$env:FOO"}),", please substitute it with ",(0,s.jsx)(n.code,{children:"%FOO%"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"network-sensitive-areas",children:"Network-Sensitive areas"}),"\n",(0,s.jsx)(n.p,{children:"There are two areas where Rancher Desktop assumes network availability and will recover in an air-gapped situation:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Pulling Kubernetes ",(0,s.jsx)(n.code,{children:"k3s"})," images into the ",(0,s.jsx)(n.code,{children:"k3s"})," cache directory"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Using ",(0,s.jsx)(n.code,{children:"kuberlr"})," as a version-aware wrapper around ",(0,s.jsx)(n.code,{children:"kubectl"}),", so the client never differs from the Kubernetes server by more than one minor version."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"existing-deployments",children:"Existing Deployments"}),"\n",(0,s.jsx)(n.p,{children:"If Rancher Desktop has been installed on a machine initially with networked access, it can\nbe run subsequently on that machine after network connectivity has been turned off. The main\ndifference in core functionality is that the list of versions of Kubernetes available in drop-down menus\nis limited to those versions that have actually been downloaded and stored in the cache."}),"\n",(0,s.jsxs)(n.p,{children:["There is a problem using the ",(0,s.jsx)(n.code,{children:"kubectl"})," client, because of the ",(0,s.jsx)(n.code,{children:"kuberlr"})," wrapper (Windows users should add the ",(0,s.jsx)(n.code,{children:".exe"})," suffix to each executable utility file)."]}),"\n",(0,s.jsx)(n.p,{children:"In this case, we're discussing a system that was initialized when connected to the internet, but we're about\nto take the machine offline for future use."}),"\n",(0,s.jsxs)(n.p,{children:["Suppose there are three versions of ",(0,s.jsx)(n.code,{children:"k3s"})," in the ",(0,s.jsx)(n.code,{children:"rancher-desktop"})," cache."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"1.24.3"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"1.21.14"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"1.19.16"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["But suppose that on this system we only ran ",(0,s.jsx)(n.code,{children:"kubectl"})," when using versions ",(0,s.jsx)(n.code,{children:"1.24.3"})," and ",(0,s.jsx)(n.code,{children:"1.21.14"}),". This means that\nthe ",(0,s.jsx)(n.code,{children:"~/.kuberlr/PLATFORM-ARCH/"})," directory (",(0,s.jsx)(n.code,{children:"$env:HOMEDRIVE%\\$env:HOMEPATH/.kuberlr/windows-amd64"})," on Windows) will contain only two files:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"kubectl1.24.3"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"kubectl1.21.14"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If we go offline and use the UI to switch to Kubernetes ",(0,s.jsx)(n.code,{children:"1.19.16"}),", when ",(0,s.jsx)(n.code,{children:"kubectl"})," is run, the system will fail.\nThe problem is that ",(0,s.jsx)(n.code,{children:"kubectl"})," is an alias for ",(0,s.jsx)(n.code,{children:"kuberlr"}),", which will try to download ",(0,s.jsx)(n.code,{children:"kubectl 1.19.16"})," and install it\nin the ",(0,s.jsx)(n.code,{children:".kuberlr"})," directory, but won't be able to access it."]}),"\n",(0,s.jsxs)(n.p,{children:["So in this case, it would be best to prepare a connected system for disconnecting by selecting each available version of\nKubernetes currently in the cache, and running ",(0,s.jsx)(n.code,{children:"kubectl --context rancher-desktop cluster-info"})," to ensure that an appropriate\nversion of the ",(0,s.jsx)(n.code,{children:"kubectl"})," client is installed."]}),"\n",(0,s.jsxs)(n.p,{children:["You ",(0,s.jsx)(n.em,{children:"could"})," install versioned ",(0,s.jsx)(n.code,{children:"kubectl"}),"s manually. This is covered in the next section."]}),"\n",(0,s.jsx)(n.h3,{id:"preparing-an-air-gapped-system",children:"Preparing an Air-Gapped System"}),"\n",(0,s.jsx)(n.p,{children:"Here we assume you have some kind of removable media which you can populate on an internet-connected system, and then move over to the air-gapped system."}),"\n",(0,s.jsx)(n.p,{children:"There are two directories that need to be populated in order for Rancher Desktop to function off-line:"}),"\n",(0,s.jsx)(n.h4,{id:"the-cache-directory",children:"The Cache Directory"}),"\n",(0,s.jsxs)(n.p,{children:["To populate a source disk (which we refer to here as ",(0,s.jsx)(n.code,{children:"%SOURCEDISK%"}),", although it is probably some kind of removable medium like a USB thumb drive), you need the following files:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"k3s-versions.json"})," -- this file is created by Rancher Desktop. It reads a raw JSON file from ",(0,s.jsx)(n.code,{children:"https://update.k3s.io/v1-release/channels"})," and converts it into a different kind of JSON file. Currently there is no utility to do that conversion; the easiest way to get this file is to run Rancher Desktop on a connected system and save the ",(0,s.jsx)(n.code,{children:"CACHE/k3s-versions.json"})," file (see below for where ",(0,s.jsx)(n.code,{children:"CACHE"})," exists on different platforms)."]}),"\n",(0,s.jsxs)(n.li,{children:["Tar archives of Kubernetes K3s images. These are listed at ",(0,s.jsx)(n.a,{href:"https://github.com/k3s-io/k3s/releases",children:"https://github.com/k3s-io/k3s/releases"}),". You'll want to download either the ",(0,s.jsx)(n.code,{children:"k3s-airgap-images-amd64.tar"})," for AMD/Intel machines, ",(0,s.jsx)(n.code,{children:"k3s-airgap-images-arm64.tar"})," for M1 machines, or the respective ",(0,s.jsx)(n.code,{children:"*.tar.zst"})," compressed tarball if you are using ",(0,s.jsx)(n.code,{children:"k3s"})," v1.26.1 and above. Finally you'll need to download the ",(0,s.jsx)(n.code,{children:"k3s"})," executable for the selected version. For example, the following commands will let you work with K3s v1.24.3 build 1 offline:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cd .../CACHE\nmkdir v1.24.3+k3s1\ncd v1.24.3+k3s1\nwget https://github.com/k3s-io/k3s/releases/download/v1.24.3%2Bk3s1/k3s-airgap-images-amd64.tar\nwget https://github.com/k3s-io/k3s/releases/download/v1.24.3%2Bk3s1/sha256sum-amd64.txt\nwget https://github.com/k3s-io/k3s/releases/download/v1.24.3%2Bk3s1/k3s\n"})}),"\n",(0,s.jsxs)(l,{groupId:"os",defaultValue:o.Z.defaultOs,children:[(0,s.jsxs)(t,{value:"Windows",children:[(0,s.jsxs)(n.p,{children:["On Windows, the cache directory is at ",(0,s.jsx)(n.code,{children:"$env:HOMEDRIVE%\\$env:HOMEPATH\\AppData\\Local\\rancher-desktop\\cache\\k3s"}),", and can be created with the command"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"mkdir -Force $env:HOMEDRIVE%\\$env:HOMEPATH\\AppData\\Local\\rancher-desktop\\cache\\k3s\n"})}),(0,s.jsx)(n.p,{children:"Assuming you have some source media, you would also run the following commands to pre-populate the cache:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"copy-item -Force $env:SOURCEDISK\\k3s-versions.json $env:HOMEDRIVE%\\$env:HOMEPATH\\AppData\\Local\\rancher-desktop\\cache\\\ncopy-item -Recurse -Force $env:SOURCEDISK\\v<MAJOR>.<MINOR>.<PATCH>+k3s<BUILD> $env:HOMEDRIVE%\\$env:HOMEPATH\\AppData\\Local\\rancher-desktop\\cache\\k3s\\\n"})})]}),(0,s.jsxs)(t,{value:"macOS",children:[(0,s.jsxs)(n.p,{children:["On macOS, the cache directory is at ",(0,s.jsx)(n.code,{children:"$HOME/Library/Caches/rancher-desktop"})," and the commands to populate it would be"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CACHEDIR=$HOME/Library/Caches/rancher-desktop\nmkdir -p $CACHEDIR/k3s\ncp $SOURCEDISK/k3s-versions.json $CACHEDIR/\ncp -r $SOURCEDISK/v<MAJOR>.<MINOR>.<PATCH>+k3s<BUILD> $CACHEDIR/k3s/\n"})})]}),(0,s.jsxs)(t,{value:"Linux",children:[(0,s.jsxs)(n.p,{children:["On Linux, the cache directory is at ",(0,s.jsx)(n.code,{children:"$HOME/.cache/rancher-desktop"})," and the commands to populate it would be"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CACHEDIR=$HOME/.cache/rancher-desktop\nmkdir -p $CACHEDIR/k3s\ncp $SOURCEDISK/k3s-versions.json $CACHEDIR/\ncp -r $SOURCEDISK/v<MAJOR>.<MINOR>.<PATCH>+k3s<BUILD> $CACHEDIR/k3s/\n"})})]})]}),"\n",(0,s.jsx)(n.h4,{id:"the-kuberlr-directory",children:"The kuberlr Directory"}),"\n",(0,s.jsxs)(n.p,{children:["The location of this directory is more straightforward. On all platforms, it's at ",(0,s.jsx)(n.code,{children:"HOME/.kuberlr/PLATFORM-ARCH"})," where:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"HOME"})," is the home directory: usually ",(0,s.jsx)(n.code,{children:"$env:HOMEDRIVE%\\$env:HOMEPATH"})," on Windows, and ",(0,s.jsx)(n.code,{children:"~"})," or ",(0,s.jsx)(n.code,{children:"$HOME"})," on macOS and Linux."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PLATFORM"})," is one of ",(0,s.jsx)(n.code,{children:"windows"}),", ",(0,s.jsx)(n.code,{children:"linux"}),", or ",(0,s.jsx)(n.code,{children:"darwin"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ARCH"})," is ",(0,s.jsx)(n.code,{children:"aarch64"})," on M1 machines, and ",(0,s.jsx)(n.code,{children:"amd64"})," everywhere else."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"To populate it, determine which versions of Kubernetes you'll be using, and download the appropriate executables from the internet. These would be in:"}),"\n",(0,s.jsxs)(l,{groupId:"os",defaultValue:o.Z.defaultOs,children:[(0,s.jsx)(t,{value:"Windows",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"https://dl.k8s.io/VERSION/bin/PLATFORM/CPU/kubectl.exe"})})}),(0,s.jsx)(t,{value:"macOS",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"https://dl.k8s.io/VERSION/bin/PLATFORM/CPU/kubectl"})})}),(0,s.jsx)(t,{value:"Linux",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"https://dl.k8s.io/VERSION/bin/PLATFORM/CPU/kubectl"})})})]}),"\n",(0,s.jsx)(n.p,{children:"Where:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VERSION"})," will have the form ",(0,s.jsx)(n.code,{children:"vMAJOR.MINOR.PATCH"})," (like ",(0,s.jsx)(n.code,{children:"v1.22.1"}),"),"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PLATFORM"})," will be one of ",(0,s.jsx)(n.code,{children:"darwin"}),", ",(0,s.jsx)(n.code,{children:"linux"}),", or ",(0,s.jsx)(n.code,{children:"windows"}),","]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CPU"})," will ",(0,s.jsx)(n.code,{children:"arm64"})," on M1 machines and ",(0,s.jsx)(n.code,{children:"amd64"})," everywhere else."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For example, to get a kubectl for Windows that will work with Kubernetes v1.22, this Windows command-shell (not PowerShell) command will put it on the ",(0,s.jsx)(n.code,{children:"SOURCEDISK"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"wget -O %SOURCEDISK/kubectl1.22.1.exe https://dl.k8s.io/v1.22.1/bin/windows/amd64/kubectl.exe\n"})}),"\n",(0,s.jsx)(n.h5,{id:"a-note-on-versions",children:"A Note on Versions"}),"\n",(0,s.jsxs)(n.p,{children:["Kubectl clients are guaranteed to work with servers that are running the same MAJOR version and differ in the MINOR version by at most 1. So for example, if your organization is working with Kubernetes versions v1.21.x, v1.22.x, and v1.23.x, for any patch-version of ",(0,s.jsx)(n.code,{children:"x"}),", you would only need to install ",(0,s.jsx)(n.code,{children:"kubectl1.22.x"})," in the ",(0,s.jsx)(n.code,{children:".kuberlr"})," directory. But if you copy a ",(0,s.jsx)(n.code,{children:"v1.24.x"})," of Kubernetes into the ",(0,s.jsx)(n.code,{children:"CACHE"})," directory, you'll need to ensure there's a compatible ",(0,s.jsx)(n.code,{children:"kubectl"})," in the ",(0,s.jsx)(n.code,{children:".kuberlr"})," directory as well (any of ",(0,s.jsx)(n.code,{children:"v1.23.x"}),", ",(0,s.jsx)(n.code,{children:"v1.24.x"}),", or ",(0,s.jsx)(n.code,{children:"v1.25.x"})," would suffice)."]})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}function p(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},93687:function(e,n,i){var s=i(10412);const r=!!s.Z.canUseDOM&&navigator.platform.startsWith("Mac"),o=!!s.Z.canUseDOM&&navigator.platform.startsWith("Win"),t=r?"ios":"android",l=r?"macOS":o?"Windows":"Linux";n.Z={defaultGuide:"quickstart",defaultOs:l,defaultPackageManager:"npm",defaultPlatform:t,defaultSyntax:"functional",defaultAndroidLanguage:"java",defaultJavaScriptSpecLanguages:"typescript",getDevNotesTabs:function(e){return void 0===e&&(e=["android","ios","web","windows"]),[e.includes("android")?{label:"Android",value:"android"}:void 0,e.includes("ios")?{label:"iOS",value:"ios"}:void 0,e.includes("web")?{label:"Web",value:"web"}:void 0,e.includes("windows")?{label:"Windows",value:"windows"}:void 0].filter(Boolean)},guides:[{label:"Expo Go Quickstart",value:"quickstart"},{label:"React Native CLI Quickstart",value:"native"}],oses:[{label:"macOS",value:"macOS"},{label:"Windows",value:"Windows"},{label:"Linux",value:"Linux"}],packageManagers:[{label:"npm",value:"npm"},{label:"Yarn",value:"yarn"}],platforms:[{label:"Android",value:"android"},{label:"iOS",value:"ios"}],syntax:[{label:"Function Component",value:"functional"},{label:"Class Component",value:"classical"}],androidLanguages:[{label:"Java",value:"java"},{label:"Kotlin",value:"kotlin"}],javaScriptSpecLanguages:[{label:"TypeScript",value:"typescript"},{label:"Flow",value:"flow"}],snackLanguages:[{label:"TypeScript",value:"typescript"},{label:"JavaScript",value:"javascript"}],defaultSnackLanguage:"typescript"}},11151:function(e,n,i){i.d(n,{Z:function(){return l},a:function(){return t}});var s=i(67294);const r={},o=s.createContext(r);function t(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);